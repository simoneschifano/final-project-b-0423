import Head from "next/head";
import Layout from "@/components/layout";
import CakeChart from "@/components/cakeChart";
import WalletList from "@/components/walletList";
import styles from "@/styles/pages/wallet.module.scss";
import { summArrayValues } from "@/utils/func";
import { useContext, useState, useEffect } from "react";
import { Context } from "@/store";

export default function Wallet() {
  const mode = "dark_mode";

  const { state, dispatch } = useContext(Context);
  const [isSwitcherTheme, setIsSwitcherTheme] = useState(false);

  const onHandleChangeTheme = () => {
    setIsSwitcherTheme((prev) => !prev);
  };
  
  const [walletInLocalStorage, setWalletInLocalStorage] = useState(
    typeof window !== "undefined"
      ? JSON.parse(localStorage.getItem("wallet"))
      : []
  );
  let value = 0;
  const cakePercentualArray = walletInLocalStorage.map(
    (item) => (value = item.qty * item.price)
  );

  // if (walletInLocalStorage.length > 0) {
  //   finalWallet = state.cryptoListData.filter((crypto) =>
  //     walletInLocalStorage.includes(crypto)
  //   );
  // } else {
  //   console.log("array vuoto");
  // }

  // useEffect(() => {
  //   localStorage.setItem("walletHome", [...finalWallet]);
  // }, [finalWallet]);
  return (
    <>
      <Head>
        <title>Crypie - Cripto Wallet</title>
        <meta name="description" content="Generated by Crypie" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main className={mode}>
        <Layout theme={isSwitcherTheme}>
          <Button text="THEME" className={styles.btn} func={onHandleChangeTheme} />
          <div className={styles.Content}>
            <h2 className={styles.title}> MY WALLET STATUS</h2>
            <div className={styles.chartArea}>
              <CakeChart
                cakePercentualArray={cakePercentualArray}
                chartData={walletInLocalStorage}
              />
              <h3 className={styles.walletValue}>
                WALLET VALUE: â‚¬ {summArrayValues(cakePercentualArray)}{" "}
              </h3>
            </div>
            <h2> Crypto </h2>
            <div className="">
              <WalletList data={walletInLocalStorage} />
            </div>
          </div>
        </Layout>
      </main>
    </>
  );
}
